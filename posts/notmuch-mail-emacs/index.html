<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Using Emacs as an email client | alexforsale.github.io</title><meta name=keywords content="emacs,mail,notmuch,microsoft,exchange"><meta name=description content="Exchange mail sync with davmail, msmtp, notmuch and emacs."><meta name=author content="Kristian Alexander P"><link rel=canonical href=https://alexforsale.github.io/posts/notmuch-mail-emacs/><link crossorigin=anonymous href=/assets/css/stylesheet.c5de734fbd88c3d21543485ffbcb1ccdda89a86a780cf987fa00199c41dbc947.css integrity="sha256-xd5zT72Iw9IVQ0hf+8sczdqJqGp4DPmH+gAZnEHbyUc=" rel="preload stylesheet" as=style><link rel=icon href=https://alexforsale.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://alexforsale.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://alexforsale.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://alexforsale.github.io/apple-touch-icon.png><link rel=mask-icon href=https://alexforsale.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://alexforsale.github.io/posts/notmuch-mail-emacs/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Using Emacs as an email client"><meta property="og:description" content="Exchange mail sync with davmail, msmtp, notmuch and emacs."><meta property="og:type" content="article"><meta property="og:url" content="https://alexforsale.github.io/posts/notmuch-mail-emacs/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-02-22T00:00:00+00:00"><meta property="article:modified_time" content="2025-07-28T14:26:09+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Using Emacs as an email client"><meta name=twitter:description content="Exchange mail sync with davmail, msmtp, notmuch and emacs."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://alexforsale.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Using Emacs as an email client","item":"https://alexforsale.github.io/posts/notmuch-mail-emacs/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Using Emacs as an email client","name":"Using Emacs as an email client","description":"Exchange mail sync with davmail, msmtp, notmuch and emacs.","keywords":["emacs","mail","notmuch","microsoft","exchange"],"articleBody":" Figure 1: Notmuch Emacs\nDavmail In my work routines, Microsoft is somewhat unavoidable, and trying to have an email client that can sync Exchange in linux has always been a pain to me. This is my documentation on how to use notmuch, davmail, and msmtp to sync my work emails.\nConfiguration davmail.server=true davmail.mode=Auto davmail.url=https://mail.domain/EWS/Exchange.asmx davmail.defaultDomain=DOMAIN davmail.ssl.nosecurecaldav=false davmail.ssl.nosecureimap=false davmail.ssl.nosecureldap=false davmail.ssl.nosecurepop=false davmail.ssl.nosecuresmtp=false davmail.caldavPort=1081 davmail.imapPort=1144 davmail.ldapPort=1390 davmail.popPort=1111 davmail.smtpPort=1026 davmail.imapAutoExpunge=true davmail.allowRemote=false davmail.logFilePath=/tmp/davmail-domain.log davmail.logFileSize=1MB davmail.disableGuiNotifications=true davmail.disableTrayActivitySwitch=true davmail.showStartupBanner=false davmail.enableKerberos=false Notes davmail.mode set to auto. uses port \u003e 1024 to avoid using root privileges. Also set the davmail.logFilePath to a path that is accessible. davmail.server set to true since I don’t need the GUI. All the ssl options is not necessary since it will only be accessed locally. msmtp It’s a simple smtp client with fairly complete sendmail compatibility. This is not a full tutorial on how to setup msmtp, there’s already much information for that online1.\n# Set default values for all following accounts. defaults auth on tls on tls_trust_file /etc/ssl/certs/ca-certificates.crt logfile /tmp/msmtp.log account exchange host localhost port 1025 tls off tls_starttls off auth plain user DOMAIN\\username from username@domain passwordeval pass domain/username Notes logfile should be accessible (read/write) by the user. account must be unique if there’s more than one accounts. tls options should refer to the exchange server. port is defined in davmail. offlineimap [general] accounts = domain maxsyncaccounts = 4 socktimeout = 10 pythonfile = ~/.local/bin/offlineimap-helper.py [Account domain] localrepository = domain-local remoterepository = domain-remote [Repository domain-local] Type = Maildir localfolders = ~/.mail/domain sync_deletes = yes autorefresh = 0.5 quick = 10 keepalive = 240 holdconnectionopen = yes [Repository domain-remote] Type = IMAP remotehosteval = get_credentials(\"domain\", \"host\") remoteporteval = get_credentials(\"domain\", \"port\") remoteusereval = get_credentials(\"domain\", \"user\") remotepasseval = get_credentials(\"domain\", \"passeval\") maxconnections = 1 ssl = no retrycount = 4 tls_level = tls_no_ssl Notes We’ll be using a helper script to determine the host, port, user, and password. offlineimap-helper.py 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 #!/usr/bin/env python \"\"\"Offlineimap helper script\"\"\" from subprocess import check_output from os import getenv, path import json JSON_FILE = \"credentials.json\" if getenv(\"XDG_DATA_HOME\") and path.exists(getenv(\"XDG_DATA_HOME\") + \"/\" + \"offlineimap\"): JSON_PATH = getenv(\"XDG_DATA_HOME\") + \"/\" + \"offlineimap\" else: JSON_PATH = getenv(\"HOME\") + \"/\" + \".local/share/offlineimap\" f = open(JSON_PATH + \"/\" + JSON_FILE) creds_data = json.load(f) def get_credentials(name, query): for item in creds_data[\"accounts\"]: if item[\"name\"] == name: if query == \"host\": return item[\"host\"] elif query == \"port\": return item[\"port\"] elif query == \"user\": return item[\"user\"] elif query == \"passeval\": return item[\"passeval\"] Notes\nThis script will read a json file located at ~/.local/share/offlineimap/credentials.json ~/.local/share/offlineimap/credentials.json 1 2 3 4 5 6 7 8 9 10 11 12 { \"accounts\": [ { \"name\": \"domain\", \"host\": \"localhost\", \"port\": 1144, \"user\": \"username\", \"passeval\": \"somepassword\" } ] } Notes: use a strict permission (such as 0700) for this file since password is written in clear text. notmuch [database] path=/home/kristian.alexander/.mail [user] name=Kristian Alexander P primary_email=username@domain [new] tags=new [search] exclude_tags=deleted;spam [maildir] synchronize_flags=true Notes: This file should be generated by the command notmuch setup. notmuch hooks We’ll be using two hooks, one is pre-new, which will be sourced whenever notmuch is running. And the other one is post-new, which we’ll be sourced after all new emails is synced.\n1 2 #!/usr/bin/env/bash [[ -x $(which offlineimap) ]] \u0026\u0026 offlineimap -s This will ensure each time we call notmuch new, it will run offlineimap.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 #!/usr/bin/env bash newcount=$(notmuch count tag:new) summary=\"Notmuch: ${newcount} new message\" if [ $newcount -gt 1 ]; then summary=\"${summary}s\"; fi if [ $newcount -gt 0 ]; then detail=\"$(notmuch search --output=summary --format=json tag:new | sed -e 's/.*authors\": \"//;s/|[^\"]*\"/\"/;s/\", \"subject\": \"/ : /;s/\".*//')\"; fi notmuch tag -new -- tag:new # See the notmuch pre-hook for DISPLAY thoughts # Desktop notifications if [ $newcount -gt 0 ]; then logger -t notmuch \"calling notify-send '$summary' '$detail'\" \u0026\u0026 notify-send -i /usr/share/icons/Papirus/symbolic/actions/mail-message-new-symbolic.svg \"$summary\" \"$detail\"; fi exit 0 cron There’s lot of ways to automate the syncing process. systemd-timer is one of them, but since I’m an old-school person, I prefer cron.\n1 crontab -l Other With all the processes above, we could use other mail clients like thunderbird or geary.\nhttps://wiki.archlinux.org/title/msmtp ↩︎\n","wordCount":"706","inLanguage":"en","datePublished":"2024-02-22T00:00:00Z","dateModified":"2025-07-28T14:26:09Z","author":[{"@type":"Person","name":"Kristian Alexander P"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://alexforsale.github.io/posts/notmuch-mail-emacs/"},"publisher":{"@type":"Organization","name":"alexforsale.github.io","logo":{"@type":"ImageObject","url":"https://alexforsale.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://alexforsale.github.io/ accesskey=h title="alexforsale.github.io (Alt + H)">alexforsale.github.io</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://alexforsale.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://alexforsale.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://alexforsale.github.io/posts/ title=posts><span>posts</span></a></li><li><a href=https://alexforsale.github.io/archives/ title=archives><span>archives</span></a></li><li><a href=https://alexforsale.github.io/about/ title=about><span>about</span></a></li><li><a href=https://alexforsale.github.io/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://alexforsale.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://alexforsale.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Using Emacs as an email client</h1><div class=post-description>Exchange mail sync with davmail, msmtp, notmuch and emacs.</div><div class=post-meta><span title='2024-02-22 00:00:00 +0000 UTC'>February 22, 2024</span>&nbsp;·&nbsp;<span title='2025-07-28 14:26:09 +0000 UTC'>(updated July 28, 2025)</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;706 words&nbsp;·&nbsp;Kristian Alexander P</div></header><div class=post-content><figure><a href=/ox-hugo/full.png><img loading=lazy src=/ox-hugo/full.png alt="Figure 1: Notmuch Emacs"></a><figcaption><p><span class=figure-number>Figure 1: </span>Notmuch Emacs</p></figcaption></figure><h2 id=davmail>Davmail<a hidden class=anchor aria-hidden=true href=#davmail>#</a></h2><p>In my work routines, <em>Microsoft</em> is somewhat unavoidable, and trying to have an email client that can sync <em>Exchange</em> in linux has always been a pain to me. This is my documentation on how to use <em>notmuch</em>, <em>davmail</em>, and <em>msmtp</em> to sync my work emails.</p><h3 id=configuration>Configuration<a hidden class=anchor aria-hidden=true href=#configuration>#</a></h3><pre tabindex=0><code class=language-nil data-lang=nil>davmail.server=true
davmail.mode=Auto
davmail.url=https://mail.domain/EWS/Exchange.asmx
davmail.defaultDomain=DOMAIN
davmail.ssl.nosecurecaldav=false
davmail.ssl.nosecureimap=false
davmail.ssl.nosecureldap=false
davmail.ssl.nosecurepop=false
davmail.ssl.nosecuresmtp=false
davmail.caldavPort=1081
davmail.imapPort=1144
davmail.ldapPort=1390
davmail.popPort=1111
davmail.smtpPort=1026
davmail.imapAutoExpunge=true
davmail.allowRemote=false
davmail.logFilePath=/tmp/davmail-domain.log
davmail.logFileSize=1MB
davmail.disableGuiNotifications=true
davmail.disableTrayActivitySwitch=true
davmail.showStartupBanner=false
davmail.enableKerberos=false
</code></pre><h4 id=notes>Notes<a hidden class=anchor aria-hidden=true href=#notes>#</a></h4><ul><li><code>davmail.mode</code> set to auto.</li><li>uses port > 1024 to avoid using root privileges.</li><li>Also set the <code>davmail.logFilePath</code> to a path that is accessible.</li><li><code>davmail.server</code> set to <code>true</code> since I don&rsquo;t need the GUI.</li><li>All the <code>ssl</code> options is not necessary since it will only be accessed locally.</li></ul><h2 id=msmtp>msmtp<a hidden class=anchor aria-hidden=true href=#msmtp>#</a></h2><p>It&rsquo;s a simple smtp client with fairly complete sendmail compatibility. This is not a full tutorial on how to setup <em>msmtp</em>, there&rsquo;s already much information for that online<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>.</p><pre tabindex=0><code class=language-nil data-lang=nil># Set default values for all following accounts.
defaults
auth           on
tls            on
tls_trust_file /etc/ssl/certs/ca-certificates.crt
logfile        /tmp/msmtp.log

account exchange
host localhost
port 1025
tls off
tls_starttls off
auth plain
user DOMAIN\username
from username@domain
passwordeval pass domain/username
</code></pre><h3 id=notes>Notes<a hidden class=anchor aria-hidden=true href=#notes>#</a></h3><ul><li><code>logfile</code> should be accessible (read/write) by the user.</li><li><code>account</code> must be unique if there&rsquo;s more than one accounts.</li><li><code>tls</code> options should refer to the <em>exchange</em> server.</li><li><code>port</code> is defined in davmail.</li></ul><h2 id=offlineimap>offlineimap<a hidden class=anchor aria-hidden=true href=#offlineimap>#</a></h2><pre tabindex=0><code class=language-nil data-lang=nil>[general]
accounts = domain
maxsyncaccounts = 4
socktimeout = 10
pythonfile = ~/.local/bin/offlineimap-helper.py

[Account domain]
localrepository = domain-local
remoterepository = domain-remote

[Repository domain-local]
Type = Maildir
localfolders = ~/.mail/domain
sync_deletes = yes
autorefresh = 0.5
quick = 10
keepalive = 240
holdconnectionopen = yes

[Repository domain-remote]
Type = IMAP
remotehosteval = get_credentials(&#34;domain&#34;, &#34;host&#34;)
remoteporteval = get_credentials(&#34;domain&#34;, &#34;port&#34;)
remoteusereval = get_credentials(&#34;domain&#34;, &#34;user&#34;)
remotepasseval = get_credentials(&#34;domain&#34;, &#34;passeval&#34;)
maxconnections = 1
ssl = no
retrycount = 4
tls_level = tls_no_ssl
</code></pre><h3 id=notes>Notes<a hidden class=anchor aria-hidden=true href=#notes>#</a></h3><ul><li>We&rsquo;ll be using a helper script to determine the <em>host</em>, <em>port</em>, <em>user</em>, and <em>password</em>.</li></ul><h3 id=offlineimap-helper-dot-py>offlineimap-helper.py<a hidden class=anchor aria-hidden=true href=#offlineimap-helper-dot-py>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;Offlineimap helper script&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>subprocess</span> <span class=kn>import</span> <span class=n>check_output</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>os</span> <span class=kn>import</span> <span class=n>getenv</span><span class=p>,</span> <span class=n>path</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>JSON_FILE</span> <span class=o>=</span> <span class=s2>&#34;credentials.json&#34;</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;XDG_DATA_HOME&#34;</span><span class=p>)</span> <span class=ow>and</span> <span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;XDG_DATA_HOME&#34;</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;/&#34;</span> <span class=o>+</span> <span class=s2>&#34;offlineimap&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>JSON_PATH</span> <span class=o>=</span> <span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;XDG_DATA_HOME&#34;</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;/&#34;</span> <span class=o>+</span> <span class=s2>&#34;offlineimap&#34;</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>JSON_PATH</span> <span class=o>=</span> <span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;HOME&#34;</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;/&#34;</span> <span class=o>+</span> <span class=s2>&#34;.local/share/offlineimap&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>f</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=n>JSON_PATH</span> <span class=o>+</span> <span class=s2>&#34;/&#34;</span> <span class=o>+</span> <span class=n>JSON_FILE</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>creds_data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_credentials</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>query</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>creds_data</span><span class=p>[</span><span class=s2>&#34;accounts&#34;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>item</span><span class=p>[</span><span class=s2>&#34;name&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=n>name</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>query</span> <span class=o>==</span> <span class=s2>&#34;host&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>item</span><span class=p>[</span><span class=s2>&#34;host&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=n>query</span> <span class=o>==</span> <span class=s2>&#34;port&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>item</span><span class=p>[</span><span class=s2>&#34;port&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=n>query</span> <span class=o>==</span> <span class=s2>&#34;user&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>item</span><span class=p>[</span><span class=s2>&#34;user&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=n>query</span> <span class=o>==</span> <span class=s2>&#34;passeval&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>item</span><span class=p>[</span><span class=s2>&#34;passeval&#34;</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><p>Notes</p><ul><li>This script will read a <em>json</em> file located at ~/.local/share/offlineimap/credentials.json</li></ul></li></ul><h3 id=dot-local-share-offlineimap-credentials-dot-json>~/.local/share/offlineimap/credentials.json<a hidden class=anchor aria-hidden=true href=#dot-local-share-offlineimap-credentials-dot-json>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;accounts&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;domain&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;host&#34;</span><span class=p>:</span> <span class=s2>&#34;localhost&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;port&#34;</span><span class=p>:</span> <span class=mi>1144</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;user&#34;</span><span class=p>:</span> <span class=s2>&#34;username&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;passeval&#34;</span><span class=p>:</span> <span class=s2>&#34;somepassword&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=notes>Notes:<a hidden class=anchor aria-hidden=true href=#notes>#</a></h4><ul><li>use a strict permission (such as <code>0700</code>) for this file since password is written in clear text.</li></ul><h2 id=notmuch>notmuch<a hidden class=anchor aria-hidden=true href=#notmuch>#</a></h2><pre tabindex=0><code class=language-nil data-lang=nil>[database]
path=/home/kristian.alexander/.mail

[user]
name=Kristian Alexander P
primary_email=username@domain
[new]
tags=new

[search]

exclude_tags=deleted;spam
[maildir]
synchronize_flags=true
</code></pre><h3 id=notes>Notes:<a hidden class=anchor aria-hidden=true href=#notes>#</a></h3><ul><li>This file should be generated by the command <code>notmuch setup</code>.</li></ul><h2 id=notmuch-hooks>notmuch hooks<a hidden class=anchor aria-hidden=true href=#notmuch-hooks>#</a></h2><p>We&rsquo;ll be using two hooks, one is <code>pre-new</code>, which will be sourced whenever <em>notmuch</em> is running. And the other one is <code>post-new</code>, which we&rsquo;ll be sourced after all new emails is synced.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=cp>#!/usr/bin/env/bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=o>[[</span> -x <span class=k>$(</span>which offlineimap<span class=k>)</span> <span class=o>]]</span> <span class=o>&amp;&amp;</span> offlineimap -s
</span></span></code></pre></td></tr></table></div></div><p>This will ensure each time we call <code>notmuch new</code>, it will run offlineimap.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=cp>#!/usr/bin/env bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=nv>newcount</span><span class=o>=</span><span class=k>$(</span>notmuch count tag:new<span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nv>summary</span><span class=o>=</span><span class=s2>&#34;Notmuch: </span><span class=si>${</span><span class=nv>newcount</span><span class=si>}</span><span class=s2> new message&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[</span> <span class=nv>$newcount</span> -gt <span class=m>1</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span> <span class=nv>summary</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>summary</span><span class=si>}</span><span class=s2>s&#34;</span><span class=p>;</span> <span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[</span> <span class=nv>$newcount</span> -gt <span class=m>0</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span> <span class=nv>detail</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>notmuch search --output<span class=o>=</span>summary --format<span class=o>=</span>json tag:new <span class=p>|</span> sed -e <span class=s1>&#39;s/.*authors&#34;: &#34;//;s/|[^&#34;]*&#34;/&#34;/;s/&#34;, &#34;subject&#34;: &#34;/ : /;s/&#34;.*//&#39;</span><span class=k>)</span><span class=s2>&#34;</span><span class=p>;</span> <span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>notmuch tag -new        -- tag:new
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># See the notmuch pre-hook for DISPLAY thoughts</span>
</span></span><span class=line><span class=cl><span class=c1># Desktop notifications</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[</span> <span class=nv>$newcount</span> -gt <span class=m>0</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span> logger -t notmuch <span class=s2>&#34;calling notify-send &#39;</span><span class=nv>$summary</span><span class=s2>&#39; &#39;</span><span class=nv>$detail</span><span class=s2>&#39;&#34;</span> <span class=o>&amp;&amp;</span> notify-send -i /usr/share/icons/Papirus/symbolic/actions/mail-message-new-symbolic.svg <span class=s2>&#34;</span><span class=nv>$summary</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=nv>$detail</span><span class=s2>&#34;</span><span class=p>;</span> <span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=nb>exit</span> <span class=m>0</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=cron>cron<a hidden class=anchor aria-hidden=true href=#cron>#</a></h2><p>There&rsquo;s lot of ways to automate the syncing process. <em>systemd-timer</em> is one of them, but since I&rsquo;m an old-school person, I prefer <em>cron</em>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>crontab -l
</span></span></code></pre></td></tr></table></div></div><h2 id=other>Other<a hidden class=anchor aria-hidden=true href=#other>#</a></h2><p>With all the processes above, we could use other mail clients like thunderbird or geary.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://wiki.archlinux.org/title/msmtp>https://wiki.archlinux.org/title/msmtp</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://alexforsale.github.io/tags/emacs/>Emacs</a></li><li><a href=https://alexforsale.github.io/tags/mail/>Mail</a></li><li><a href=https://alexforsale.github.io/tags/notmuch/>Notmuch</a></li><li><a href=https://alexforsale.github.io/tags/microsoft/>Microsoft</a></li><li><a href=https://alexforsale.github.io/tags/exchange/>Exchange</a></li></ul><nav class=paginav><a class=prev href=https://alexforsale.github.io/posts/hyprland/><span class=title>« Prev</span><br><span>Hyprland</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://alexforsale.github.io/>alexforsale.github.io</a></span>
<span><a href=https://github.com/alexforsale/alexforsale.github.io/ rel="noopener noreferrer" target=_blank>source</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>